<head>
    <link rel="stylesheet" href="report-issues.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>

<style>
    #additionalInfo {
        display: none;
    }
</style>

<div class="container">
    <div class="components">
        <form id="login-form" class="form">

            <div class="div1">
                <!-- choose what bathroom has an issue and report it -->
                <div class="segmented-control">

                    <input type="radio" name="radio2" value="3" id="tab-1" checked />
                    <label for="tab-1" class="segmented-control__1">
                        <p>BR 1</p>
                    </label>

                    <input type="radio" name="radio2" value="4" id="tab-2" />
                    <label for="tab-2" class="segmented-control__2">
                        <p>BR 2</p>
                    </label>

                    <input type="radio" name="radio2" value="5" id="tab-3" />
                    <label for="tab-3" class="segmented-control__3">
                        <p>BR 3</p>
                    </label>

                    <div class="segmented-control__color"></div>
                </div>
            </div>



            <br><br>

            <!-- checkbox for selecting an issue -->
            <!-- checkbox for selecting an issue -->
            <div class="checkbox">
                <div class="div2">

                    <div class="checkbox__1">
                        <input id="checkbox-1" type="checkbox" value="No Door Lock">
                        <label for="checkbox-1">
                            <i class="material-icons">done</i></label>
                        <p class="checkbox_text">No Door Lock</p>
                    </div>
                </div>

                <div class="div3">

                    <div class="checkbox__2">
                        <input id="checkbox-2" type="checkbox" value="No Toilet Paper">
                        <label for="checkbox-2">
                            <i class="material-icons">done</i>
                        </label>
                        <p class="checkbox_text">No Toilet Paper</p>
                    </div>
                </div>


                <div class="div4">

                    <div class="checkbox__3">
                        <input id="checkbox-3" type="checkbox" value="No Stall Doors">
                        <label for="checkbox-3">
                            <i class="material-icons">done</i>
                        </label>
                        <p class="checkbox_text">No Stall Doors</p>
                    </div>
                </div>

                <div class="div5">

                    <div id="checkbox_4" class="checkbox__4">
                        <input id="checkbox-4" type="checkbox" value="Other">
                        <label for="checkbox-4">
                            <i class="material-icons">done</i>
                        </label>
                        <p class="checkbox_text">Other</p>
                    </div>
                </div>

            </div>

            <br><br>

            <div class="div6">

                <!-- any additional info to add -->
                <input id="additionalInfo" class="form__input" type="text" placeholder="Anything else?" /><br><br>

                <!-- report an issue Button -->
                <button id="report-btn" class="btn btn__primary" type="button" onclick="report_box()">
                    <p>Report Issue</p>
                </button><br>

                <!-- cancel Button -->
                <a href="{{site.baseurl}}/bathroom" class="btn btn__secondary" id="create-account-btn">
                    <p>Cancel</p>
                </a>
            </div>
        </form>

        <!-- Error Chip (Hidden Initially) -->
        <div class="chip" id="error-chip" style="display:none;">
            <div class="chip__icon">
                <ion-icon name="warning-outline"></ion-icon>
            </div>
            <p>Error reporting issue.</p> <!-- This message can change dynamically -->
            <span class="chip__close" onclick="hideChip()"><ion-icon name="close"></ion-icon></span>
        </div>
    </div>
</div>

<script type="module">
    import { javaURI, pythonURI, fetchOptions } from '{{ site.baseurl }}/assets/js/api/config.js';

    const other = document.getElementById("checkbox_4");

    other.addEventListener('click', function () {
        console.log('other clicked');
        document.getElementById('additionalInfo').style.display = 'block';
    })
    const url = `http://localhost:8085/api/issue/update/`;

    window.report_box = function report_box() {
        // Collect all selected checkboxes
        const selectedBathroom = document.querySelector('input[name="radio2"]:checked');
        if (!selectedBathroom) {
            alert("Please select a bathroom.");
            return;
        }
        let bathroomValue = selectedBathroom.value; // Make sure to use `let` for reassignment
        switch (bathroomValue) {
            case '3':
                bathroomValue = 'Bathroom 1';
                break;
            case '4':
                bathroomValue = 'Bathroom 2';
                break;
            case '5':
                bathroomValue = 'Bathroom 3';
                break;
        }

        const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
        const selectedIssues = [];

        checkboxes.forEach(checkbox => {
            selectedIssues.push(checkbox.value); // Collect the values of selected checkboxes
        });

        const additionalIssue = document.getElementById("additionalInfo").value;
        if (selectedIssues.length === 0 && additionalIssue == null) {
            alert("Please select at least one issue.");
            return;
        }
        if (selectedIssues[0] == 'Other' && additionalIssue != null) {
            selectedIssues[0] = additionalIssue;
        }

        const reportData = {
            bathroomName: bathroomValue,
            issue: selectedIssues[0], // Sending all issues instead of just the first one
            count: 1
        };
        console.log(JSON.stringify(reportData));

        // Create a unique URL for each issue
        const putOptions = {
            ...fetchOptions,
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(reportData), // Send the current issue in the body
        };

        // Send individual PUT requests for each issue
        fetch('http://localhost:8085/api/issue/add', putOptions)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok: ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                console.log('Success for issue:', data);
            })
            .catch(error => {
                console.error('Error for issue:', error);
            });


        alert("Issues reported!");
    };

</script>

<script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>