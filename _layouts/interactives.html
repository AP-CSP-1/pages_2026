---
layout: opencs
---

<div class="lesson-container">
  <!-- Sidebar with Lesson Links -->
  <aside class="lesson-sidebar">
    <h3>üéÆ Solitaire Lessons</h3>
    <ul>
      <li><a href="{{site.baseurl}}/solitaire/lesson/frontend">Lesson 1: Frontend</a></li>
      <li><a href="{{site.baseurl}}/solitaire/lesson/oop">Lesson 2: JavaScript OOP</a></li>
      <li><a href="{{site.baseurl}}/solitaire/lesson/problem-solving">Lesson 3: Problem Solving</a></li>
    </ul>
  
    <h3>üí° Future References</h3>
    <ul>
      <li><a href="{{site.baseurl}}/solitaire/lesson/future-references">Future Reference Tags</a></li>
    </ul>
    <hr>

    <!-- Time Tracker -->
    <h4>‚è±Ô∏è Study Time</h4>
    <div class="time-display">
      <span id="total-time">0:00</span>
      <small>on this lesson</small>
    </div>
    <div id="timer-status" class="timer-status">Active</div>

    <hr>

    <!-- Progress Tracker -->
    <h4>üìä Your Progress</h4>
    <div class="progress-bar">
      <div class="progress-fill" id="lesson-progress"></div>
    </div>
    <p id="progress-text">0% complete</p>
    <button id="reset-progress" class="btn small-btn">Reset Progress</button>

    <hr>

    <!-- Badges -->
    <h4>üèÖ Your Badges</h4>
    <p id="badges">No badges yet...</p>
  </aside>

  <!-- Main Lesson Content -->
  <main class="lesson-content">
    <h1>{{ page.title }}</h1>
    <div class="post-content">
      {{ content }}
    </div>

    <hr>

    <!-- Sandbox -->
    <div class="sandbox">
      <h3>üñ•Ô∏è Try It Yourself</h3>
      <textarea id="sandbox-code">
// Example: Flip a card
let card = { rank: "A", suit: "Spades", faceUp: false };
card.faceUp = true;
console.log(card);
      </textarea>
      <button id="run-sandbox">Run Code</button>
      <pre id="sandbox-output"></pre>
    </div>

    <hr>

    <!-- Reflection & Quiz -->
    <div class="lesson-quiz">
      <h3>üìù Quick Check</h3>
      <p>What's one key idea you learned from this lesson?</p>
      <textarea id="reflection-box" placeholder="Type your reflection or answer here..."></textarea>
      <button id="save-reflection">Save</button>
      <p id="reflection-status"></p>
    </div>

    <hr>

    <!-- Resources -->
    <div class="resources">
      <h3>üìö Related Resources</h3>
      <ul>
        <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes" target="_blank">MDN: JavaScript Classes</a></li>
        <li><a href="https://css-tricks.com/snippets/css/a-guide-to-flexbox/" target="_blank">CSS Tricks: Flexbox Guide</a></li>
        <li><a href="https://javascript.info/" target="_blank">The Modern JavaScript Tutorial</a></li>
      </ul>
    </div>

    <!-- Navigation -->
    <div class="lesson-nav">
      {% if page.prev_url %}<a href="{{ page.prev_url }}" class="btn">‚¨Ö Previous</a>{% endif %}
      {% if page.next_url %}<a href="{{ page.next_url }}" class="btn">Next ‚û°</a>{% endif %}
    </div>
  </main>
</div>

<script>
// Time Tracker Class
class TimeTracker {
  constructor(lessonId) {
    this.lessonId = lessonId;
    this.sessionStart = Date.now();
    this.totalTime = this.loadTotalTime();
    this.isActive = true;
    this.interval = null;
    
    this.init();
  }
  
  init() {
    // Update display every second
    this.interval = setInterval(() => {
      if (this.isActive) {
        this.updateDisplay();
      }
    }, 1000);
    
    // Listen for page visibility changes
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        this.pause();
      } else {
        this.resume();
      }
    });
    
    // Listen for window focus/blur
    window.addEventListener('blur', () => this.pause());
    window.addEventListener('focus', () => this.resume());
    
    // Save time before page unload
    window.addEventListener('beforeunload', () => {
      this.saveTime();
    });
    
    this.updateDisplay();
  }
  
  pause() {
    if (this.isActive) {
      this.isActive = false;
      this.saveTime();
      document.getElementById('timer-status').textContent = 'Paused';
      document.getElementById('timer-status').className = 'timer-status paused';
    }
  }
  
  resume() {
    if (!this.isActive) {
      this.isActive = true;
      this.sessionStart = Date.now();
      document.getElementById('timer-status').textContent = 'Active';
      document.getElementById('timer-status').className = 'timer-status active';
    }
  }
  
  formatTime(milliseconds) {
    const seconds = Math.floor(milliseconds / 1000);
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    
    if (mins >= 60) {
      const hours = Math.floor(mins / 60);
      const remainingMins = mins % 60;
      return `${hours}:${remainingMins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }
    
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  }
  
  updateDisplay() {
    const currentSessionTime = this.isActive ? Date.now() - this.sessionStart : 0;
    const displayTime = this.totalTime + currentSessionTime;
    document.getElementById('total-time').textContent = this.formatTime(displayTime);
  }
  
  loadTotalTime() {
    const key = `lesson-time-${this.lessonId}`;
    return parseInt(localStorage.getItem(key)) || 0;
  }
  
  saveTime() {
    if (this.isActive) {
      const sessionTime = Date.now() - this.sessionStart;
      const key = `lesson-time-${this.lessonId}`;
      this.totalTime += sessionTime;
      localStorage.setItem(key, this.totalTime.toString());
      this.sessionStart = Date.now();
    }
  }
  
  destroy() {
    if (this.interval) {
      clearInterval(this.interval);
    }
    this.saveTime();
  }
}

// Main app logic
document.addEventListener("DOMContentLoaded", () => {
  const lessons = ["frontend","oop","problem-solving","future-references"];
  const key = "lesson-progress";
  let progress = JSON.parse(localStorage.getItem(key)) || {};

  const current = window.location.pathname.split("/").pop() || 'lesson';
  
  // Initialize time tracker
  const timeTracker = new TimeTracker(current);
  
  if (current) progress[current] = true;
  localStorage.setItem(key, JSON.stringify(progress));

  let done = Object.keys(progress).length;
  let percent = Math.floor((done / lessons.length) * 100);
  document.getElementById("lesson-progress").style.width = percent + "%";
  document.getElementById("progress-text").textContent = percent + "% complete";

  document.getElementById("reset-progress").onclick = () => {
    if (confirm("Reset all progress and time data?")) {
      localStorage.removeItem(key);
      localStorage.removeItem("lesson-badges");
      
      // Clear all lesson times
      lessons.forEach(lesson => {
        localStorage.removeItem(`lesson-time-${lesson}`);
      });
      
      document.getElementById("lesson-progress").style.width = "0%";
      document.getElementById("progress-text").textContent = "0% complete";
      document.getElementById("badges").textContent = "No badges yet...";
      
      // Reset time tracker
      timeTracker.destroy();
      location.reload();
    }
  };

  // Badges
  let badges = JSON.parse(localStorage.getItem("lesson-badges")) || [];
  if (!badges.includes(current)) {
    badges.push(current);
    localStorage.setItem("lesson-badges", JSON.stringify(badges));
  }
  document.getElementById("badges").textContent = badges.length ? badges.join(", ") : "No badges yet...";

  // Reflection save
  const saveBtn = document.getElementById("save-reflection");
  const box = document.getElementById("reflection-box");
  const status = document.getElementById("reflection-status");
  const refKey = "reflection-" + current;
  box.value = localStorage.getItem(refKey) || "";

  saveBtn.addEventListener("click", () => {
    localStorage.setItem(refKey, box.value);
    status.textContent = "Saved!";
    setTimeout(() => status.textContent = "", 1500);
  });

  // Sandbox
  document.getElementById("run-sandbox").onclick = () => {
    const code = document.getElementById("sandbox-code").value;
    try {
      const result = eval(code);
      document.getElementById("sandbox-output").textContent = result ?? "‚úÖ Ran successfully!";
    } catch (e) {
      document.getElementById("sandbox-output").textContent = "‚ùå Error: " + e.message;
    }
  };

  // Copy buttons for code
  document.querySelectorAll("pre > code").forEach(block => {
    const btn = document.createElement("button");
    btn.textContent = "Copy";
    btn.className = "copy-btn";
    btn.onclick = () => {
      navigator.clipboard.writeText(block.innerText);
      btn.textContent = "Copied!";
      setTimeout(() => btn.textContent = "Copy", 1500);
    };
    block.parentNode.style.position = "relative";
    block.parentNode.appendChild(btn);
  });
});
</script>

<style>
.lesson-container {
  display: flex;
  gap: 2rem;
}
.lesson-sidebar {
  flex: 0 0 250px;
  background: #1f2020;
  padding: 1rem;
  border-radius: 8px;
  position: sticky;
  top: 1rem;
  height: fit-content;
  color: #f0f0f0;
}
.lesson-content {
  flex: 1;
}

/* Time Tracker Styles */
.time-display {
  background: #2a2d2d;
  padding: 0.5rem;
  margin: 0.25rem 0;
  border-radius: 4px;
  text-align: center;
}
.time-display span {
  font-size: 1.2rem;
  font-weight: bold;
  color: #4cafef;
  display: block;
}
.time-display small {
  font-size: 0.75rem;
  color: #aaa;
}
.timer-status {
  text-align: center;
  padding: 0.25rem;
  border-radius: 4px;
  font-size: 0.8rem;
  font-weight: bold;
  margin-top: 0.5rem;
}
.timer-status.active {
  background: #2d5a3d;
  color: #4ade80;
}
.timer-status.paused {
  background: #5a3d2d;
  color: #fbbf24;
}

.progress-bar {
  background: #333;
  border-radius: 6px;
  height: 12px;
  width: 100%;
  margin: 0.5rem 0;
}
.progress-fill {
  background: #4cafef;
  height: 100%;
  width: 0%;
  border-radius: 6px;
}
.copy-btn {
  position: absolute;
  top: 5px;
  right: 5px;
  padding: 3px 8px;
  font-size: 0.8rem;
  cursor: pointer;
}
.lesson-quiz textarea {
  width: 100%;
  min-height: 80px;
  margin: 0.5rem 0;
}
.btn {
  display: inline-block;
  background: #007acc;
  color: white;
  padding: 6px 12px;
  border-radius: 4px;
  text-decoration: none;
  margin: 0.5rem;
  border: none;
  cursor: pointer;
}
.btn:hover {
  background: #005fa3;
}
.small-btn {
  font-size: 0.75rem;
  padding: 3px 6px;
  margin-top: 0.5rem;
}
.sandbox textarea {
  width: 100%;
  height: 120px;
  font-family: monospace;
  margin-bottom: 0.5rem;
}
.resources, .sandbox, .lesson-quiz {
  background: #2b2b2b;
  padding: 1rem;
  border-radius: 8px;
  margin: 1rem 0;
  color: #f0f0f0;
}
</style>