<head>
    <link rel="stylesheet" href="profile.css">
</head>

<div class="container">
    <div class="components">
        <div class="div3">
            <!-- Create Account Button -->
            <a href="{{site.baseurl}}/bathroom" class="btn btn__secondary" id="create-account-btn">
                <p>Bathroom</p>
            </a>

            <a href="{{site.baseurl}}/analytics" class="btn btn__secondary" id="create-account-btn">
                <p>Analytics</p>
            </a>

            <!-- <a href="#" class="btn btn__secondary" id="create-account-btn">
                <p>Games</p>
            </a> -->
        </div>

        <div class="div1">
            <!-- Profile Picture Section -->
            <div class="profile-picture">
                <!-- or "https://upload.wikimedia.org/wikipedia/en/4/4d/Miles_Dyson_%28T2%29.jpg" -->
                 <!-- https://github.com/user-attachments/assets/790d1347-3c6e-4ae4-a36b-43857f9b2ff0 -->
                <img src="#"
                    alt="Profile Picture" class="profile-img">
            </div>
        </div>

        <div class="div2">
            <!-- Name and Basic Info Section -->
            <div class="info">
                <div class="name">
                    <input id="name" class="form__input" type="text" placeholder="Name" readonly />
                </div>
                <br>

                <div class="email-info">
                    <input id="email" class="form__input" type="email" placeholder="Email" readonly /><br>
                </div>
                <br>
<!-- 
                <div class="myplan-info">
                    <input id="myplan" class="form__input" type="myplan" placeholder="MyPlan User" readonly /><br>
                </div> -->
            </div>
        </div>
    </div>
</div>

<script>
    import { javaURI, fetchOptions } from '{{ site.baseurl }}/assets/js/api/config.js'

    // Fetch profile data for a specific user
    document.addEventListener("DOMContentLoaded", () => {
        const email = localStorage.getItem("email"); // Assuming email is stored in localStorage upon login
        if (email) {
            // Construct the URL with the email
            const url = javaURI + '/profile/${encodeURIComponent(email)}';
            fetchProfileData(url);
        } else {
            console.error("User email not found.");
        }
    });

    async function fetchProfileData(url) {
        try {
            const response = await fetch(url); // Use the constructed URL
            if (response.ok) {
                const profileData = await response.json();
                populateProfileFields(profileData);
            } else {
                document.getElementById('error-chip').style.display = 'flex';
            }
        } catch (error) {
            console.error('Error fetching profile data:', error);
            document.getElementById('error-chip').style.display = 'flex';
        }
    }

    // Populate the HTML elements with the profile data
    function populateProfileFields(data) {
        document.getElementById('name').value = data.name;
        document.getElementById('email').value = data.email;
        // document.getElementById('myplan').value = data.myplan;
        document.getElementById('other-info').value = data.otherInfo || ''; // Assuming `otherInfo` exists in your API
        document.getElementById('freq-per-day').textContent = data.freqPerDay || '--';
        document.getElementById('freq-per-week').textContent = data.freqPerWeek || '--';
        document.getElementById('avg-duration').textContent = data.avgDuration || '--';
        document.getElementById('issues-history').value = data.issuesHistory || ''; // Assuming `issuesHistory` exists in your API
    }

    // Function to hide the error chip when the close button is clicked
    function hideChip() {
        document.getElementById('error-chip').style.display = 'none';
    }
</script>

<!-- <script src="profile.js"></script> -->
<script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>