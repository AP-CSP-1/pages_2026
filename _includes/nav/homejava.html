<table>
    <tr id="navbar">
        <td><img src="{{site.baseurl}}/images/logo.png" height="60" title="Toolkit Login" alt=""></td>
        <td id="profileLink"></td>
        <td id="gamifyLink"></td>
        <td id="studentToolkitLink"></td>
        <td id="teacherToolkitLink"></td>
        <td><a href="{{site.baseurl}}/signup">Sign Up Toolkit</a></td>
        <td id="loginArea"><a href="{{site.baseurl}}/toolkit-login">Login to Toolkit!</a></td>
    </tr>
</table>

<script type="module">
    import { javaURI, fetchOptions } from '{{site.baseurl}}/assets/js/api/config.js';

    document.addEventListener('DOMContentLoaded', function() {
        getCredentialsJava()
            .then(data => {
                const loginArea = document.getElementById('loginArea');
                const profileLink = document.getElementById('profileLink');
                const gamifyLink = document.getElementById('gamifyLink');
                const studentToolkitLink = document.getElementById('studentToolkitLink');
                const teacherToolkitLink = document.getElementById('teacherToolkitLink');

                if (data) { // User is authenticated
                    // Check for ROLE_TEACHER
                    const isTeacher = data.roles.some(role => role.name === 'ROLE_TEACHER');

                    // Update login area with dropdown links
                    loginArea.innerHTML = `
                        <div class="dropdown">
                            <button class="dropbtn">${data.name}</button>
                            <div class="dropdown-content">
                                <a href="{{site.baseurl}}/logoutjava">Logout</a>
                                <a href="{{site.baseurl}}/profilejava">Profile</a>
                                <a href="{{site.baseurl}}/stats">Health/Exercise Data</a>
                                ${isTeacher ? '<a href="{{site.baseurl}}/teacher">Teacher Toolkit</a>' : ''}
                                <a href="{{site.baseurl}}/gamify/adventureGame">Gamify</a>
                                <a href="{{site.baseurl}}/student">Student Toolkit</a>
                            </div>
                        </div>
                    `;

                    // Display "Profile," "Gamify," and "Student Toolkit"
                    profileLink.innerHTML = `<a href="{{site.baseurl}}/profilejava">Profile</a>`;
                    gamifyLink.innerHTML = `<a href="{{site.baseurl}}/gamify/adventureGame">Gamify</a>`;
                    studentToolkitLink.innerHTML = `<a href="{{site.baseurl}}/student">Student Toolkit</a>`;

                    // Check for teacher role to display "Teacher Toolkit"
                    if (isTeacher) {
                        teacherToolkitLink.innerHTML = `<a href="{{site.baseurl}}/teacher">Teacher Toolkit</a>`;
                    }
                } else {
                    // User is not authenticated
                    loginArea.innerHTML = '<a href="{{site.baseurl}}/duallogin">Login</a>';
                }
            })
            .catch(err => {
                console.error("Error fetching credentials: ", err);
            });
    });

    function getCredentialsJava() {
        const URL = javaURI + '/api/person/get';
        return fetch(URL, fetchOptions)
            .then(response => {
                if (response.status !== 200) {
                    console.error("HTTP status code: " + response.status);
                    return null;
                }
                return response.json();
            })
            .then(data => {
                if (data === null) return null;
                console.log(data);
                return data;
            })
            .catch(err => {
                console.error("Fetch error: ", err);
                return null;
            });
    }
</script>
