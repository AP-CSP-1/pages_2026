<table>
    <tr id="navbar">
        <td><img src="{{site.baseurl}}/images/logo.png" height="60" title="Toolkit Menu" alt=""></td>
        <td id="profileLink"></td>
        <td id="gamifyLink"></td>
        <td id="studentToolkitLink"></td>
        <td id="teacherToolkitLink"></td>
        <td id="signupLink"><a href="{{site.baseurl}}/signup">Sign Up Toolkit</a></td>
        <td id="javaLoginArea"><a href="{{site.baseurl}}/toolkit-login">Login to Toolkit!</a></td>
        <td id="logoutLink"></td>
    </tr>
</table>

<script type="module">
    import { javaURI, fetchOptions } from '{{site.baseurl}}/assets/js/api/config.js';

    document.addEventListener('DOMContentLoaded', function() {
        getCredentialsJava()
            .then(data => {
                const javaLoginArea = document.getElementById('javaLoginArea');
                const signupLink = document.getElementById('signupLink');
                const profileLink = document.getElementById('profileLink');
                const gamifyLink = document.getElementById('gamifyLink');
                const studentToolkitLink = document.getElementById('studentToolkitLink');
                const teacherToolkitLink = document.getElementById('teacherToolkitLink');
                const logoutLink = document.getElementById('logoutLink');

                if (data) { // User is authenticated
                    // Hide signup and login links
                    signupLink.style.display = 'none';
                    javaLoginArea.style.display = 'none';

                    // Check for ROLE_TEACHER
                    const isTeacher = data.roles.some(role => role.name === 'ROLE_TEACHER');

                    // Display "Profile," "Gamify," and "Student Toolkit"
                    profileLink.innerHTML = `<a href="{{site.baseurl}}/profilejava">Profile</a>`;
                    gamifyLink.innerHTML = `<a href="{{site.baseurl}}/gamify/adventureGame">Gamify</a>`;
                    studentToolkitLink.innerHTML = `<a href="{{site.baseurl}}/student">Student Toolkit</a>`;

                    // Check for teacher role to display "Teacher Toolkit"
                    if (isTeacher) {
                        teacherToolkitLink.innerHTML = `<a href="{{site.baseurl}}/teacher">Teacher Toolkit</a>`;
                    }

                    // Display logout link
                    logoutLink.innerHTML = `<a href="{{site.baseurl}}/logoutjava">Logout</a>`;
                } else {
                    // User is not authenticated, show signup and login links
                    signupLink.style.display = 'block';
                    javaLoginArea.style.display = 'block';

                    // Hide other links
                    profileLink.style.display = 'none';
                    gamifyLink.style.display = 'none';
                    studentToolkitLink.style.display = 'none';
                    teacherToolkitLink.style.display = 'none';
                    logoutLink.style.display = 'none';
                }
            })
            .catch(err => {
                console.error("Error fetching credentials: ", err);
            });
    });

    function getCredentialsJava() {
        const URL = javaURI + '/api/person/get';
        return fetch(URL, fetchOptions)
            .then(response => {
                if (response.status !== 200) {
                    console.error("HTTP status code: " + response.status);
                    return null;
                }
                return response.json();
            })
            .then(data => {
                if (data === null) return null;
                console.log(data);
                return data;
            })
            .catch(err => {
                console.error("Fetch error: ", err);
                return null;
            });
    }
</script>