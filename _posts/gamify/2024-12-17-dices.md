---
layout: finance
title: Dice Game
permalink: /gamify/dices
---

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    .container {
        max-width: 600px;
        color: #fff;
    }
    .error-message {
        color: #ff6b6b; 
        margin-top: 10px;
        display: none;
    }
    .success-message {
        color: #51cf66;
        margin-top: 10px;
        display: none;
    }
    .slider-value {
        text-align: center;
        margin-bottom: 10px;
        font-size: 1.2rem;
    }
    .card-title {
        color: white;
    }
</style>

<body class="m-0 p-0" style="font-family: 'Poppins', sans-serif; background-color: #121212; color: #fff;">

<div class="container my-5">
  <!-- Dice Game Card -->
  <div class="card bg-dark border-secondary mb-4">
    <div class="card-body">
      <h2 class="card-title mb-3">Dice Game</h2>
      <form id="betForm" class="d-flex flex-column gap-3">
        <div class="mb-3">
          <label for="betAmount" class="form-label">Bet Amount:</label>
          <input 
            type="number" 
            id="betAmount" 
            class="form-control text-center" 
            min="1000"
            placeholder="Enter bet amount" 
            required
          >
        </div>
        <div class="mb-3">
          <label for="betProbability" class="form-label">Bet Probability:</label>
          <input 
            type="range" 
            id="betProbability" 
            class="form-range" 
            min="0" 
            max="100" 
            value="50" 
            step="10"
          >
          <div class="slider-value" id="sliderValue">50%</div>
        </div>
        <div id="errorMessage" class="error-message text-center"></div>
        <div id="successMessage" class="success-message text-center"></div>
        <button type="submit" class="btn btn-primary mx-auto">Start Bet</button>
      </form>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>
<script type="module">
    import { javaURI, fetchOptions } from '{{site.baseurl}}/assets/js/api/config.js';
    
    let uid = "";
    const errorElement = document.getElementById('errorMessage');
    const successElement = document.getElementById('successMessage');
    
    function showError(message) {
        errorElement.textContent = message;
        errorElement.style.display = 'block';
        setTimeout(() => errorElement.style.display = 'none', 5000);
    }

    function showSuccess(message) {
        successElement.textContent = message;
        successElement.style.display = 'block';
        setTimeout(() => successElement.style.display = 'none', 5000);
    }
    
    async function getUID() {
        console.log("Starting getUID function.");
        const url = `${javaURI}/api/person/get`;
        console.log("Fetching URL:", url);
        try {
            const response = await fetch(url, fetchOptions);
            console.log("Fetch response received:", response);
            if (!response.ok) {
                console.error("Error fetching UID. Response status:", response.status);
                throw new Error(`Spring server response: ${response.status}`);
            }
            const data = await response.json();
            uid = data.uid;
            console.log("UID fetched successfully:", uid);
        } catch (error) {
            console.error("Error in getUID:", error);
            showError("Failed to get user ID. Please ensure you're logged in.");
        }
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        const betForm = document.getElementById('betForm');
        const betProbability = document.getElementById('betProbability');
        const sliderValue = document.getElementById('sliderValue');
        
        // Update slider display value
        betProbability.addEventListener('input', () => {
            sliderValue.textContent = `${betProbability.value}%`;
        });
        
        // Form submission
        betForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            errorElement.style.display = 'none';
            successElement.style.display = 'none';
            
            await getUID();
            const betAmount = parseFloat(document.getElementById('betAmount').value);
            
            if (!betAmount || betAmount < 1000) {
                showError("Please enter a valid bet amount (minimum 1000)");
                return;
            }
            
            const probability = parseFloat(betProbability.value) / 100;
            const betData = {
                uid: uid,
                betSize: betAmount,
                winChance: probability,
            };
            
            console.log(betData);
            
            try {
                const response = await fetch(`${javaURI}/api/casino/dice/calculate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...fetchOptions.headers
                    },
                    body: JSON.stringify(betData),
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    throw new Error(`Request failed with status: ${response.status}`);
                }
                
                const result = await response.json();
                if (result && result !== undefined) {
                    showSuccess(`Success! Your new balance: $${result}`);
                } else {
                    showError('Unexpected response format.');
                }
            } catch (error) {
                console.error('Error during bet calculation:', error);
                showError('An error occurred. Please check that you are logged in and betting a valid amount.');
            }
        });
    });
</script>
</body>